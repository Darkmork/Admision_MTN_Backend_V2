version: "prometheus/v1"
service: "user-service"
labels:
  team: "backend"
  environment: "production"
  component: "authentication"
  
slos:
  # Latency SLO - 99% of requests should complete in <2s
  - name: "requests-latency"
    objective: 99
    description: "99% of user service HTTP requests should complete in less than 2 seconds"
    sli:
      events:
        error_query: sum(rate(http_server_requests_seconds_count{app="user-service", le!="2"}[5m]))
        total_query: sum(rate(http_server_requests_seconds_count{app="user-service"}[5m]))
    alerting:
      name: UserServiceLatency
      labels:
        category: latency
        service: user-service
      annotations:
        summary: "User Service latency SLO violation"
        runbook: "https://runbooks.mtn.cl/slo/user-service-latency"
      page_alert:
        labels:
          severity: page
          team: backend
        annotations:
          summary: "User Service latency SLO burn rate is critical"
          description: "User authentication and management operations are slow"
          impact: "Users experiencing delays in login and profile operations"
          action: "Check database query performance, review authentication cache, verify connection pool"
      ticket_alert:
        labels:
          severity: ticket
          team: backend
        annotations:
          summary: "User Service latency trending towards SLO violation"

  # Availability SLO - 95% of requests should be successful
  - name: "requests-availability" 
    objective: 95
    description: "95% of user service HTTP requests should be successful (status code <500)"
    sli:
      events:
        error_query: sum(rate(http_server_requests_seconds_count{app="user-service",status=~"5.."}[5m]))
        total_query: sum(rate(http_server_requests_seconds_count{app="user-service"}[5m]))
    alerting:
      name: UserServiceAvailability
      labels:
        category: availability
        service: user-service
      annotations:
        summary: "User Service availability SLO violation"
        runbook: "https://runbooks.mtn.cl/slo/user-service-availability"
      page_alert:
        labels:
          severity: page
          team: backend
        annotations:
          summary: "User Service availability SLO burn rate is critical"
          description: "User service experiencing high error rates"
          impact: "Users cannot login or access their profiles - system authentication failing"
          action: "IMMEDIATE: Check database connectivity, verify JWT service, review recent deployments"
      ticket_alert:
        labels:
          severity: ticket
          team: backend
        annotations:
          summary: "User Service availability requires investigation"

  # Authentication Success Rate SLO - 99% of auth attempts should succeed
  - name: "auth-success-rate"
    objective: 99
    description: "99% of authentication attempts should be successful"
    sli:
      events:
        error_query: sum(rate(user_authentication_attempts_total{app="user-service",result!="success"}[5m]))
        total_query: sum(rate(user_authentication_attempts_total{app="user-service"}[5m]))
    alerting:
      name: UserServiceAuthSuccess
      labels:
        category: business_logic
        service: user-service
      annotations:
        summary: "User authentication success rate SLO violation"
        runbook: "https://runbooks.mtn.cl/slo/user-service-auth"
      page_alert:
        labels:
          severity: page
          team: backend
        annotations:
          summary: "Authentication failure rate is critical"
          description: "High number of authentication failures"
          impact: "Users cannot access the admission system"
          action: "Check JWT configuration, verify database user records, review brute force protection"
      ticket_alert:
        labels:
          severity: ticket
          team: backend
        annotations:
          summary: "Authentication success rate trending down"