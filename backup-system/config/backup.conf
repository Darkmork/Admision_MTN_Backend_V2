# ============================================================
# BACKUP SYSTEM CONFIGURATION
# Sistema de Backup Automático para PostgreSQL
# Proyecto: Admisión MTN
# ============================================================

# --- DATABASE CONFIGURATION ---
DB_HOST="localhost"
DB_PORT="5432"
DB_NAME="Admisión_MTN_DB"
DB_USER="admin"
DB_PASSWORD="admin123"

# --- POSTGRESQL TOOLS PATH (for version compatibility) ---
PG_DUMP="/opt/homebrew/opt/postgresql@15/bin/pg_dump"
PSQL="/opt/homebrew/opt/postgresql@15/bin/psql"

# --- BACKUP PATHS ---
BACKUP_ROOT="/Users/jorgegangale/Library/Mobile Documents/com~apple~CloudDocs/Proyectos/Admision_MTN/Admision_MTN_backend/backup-system"
BACKUP_DIR="${BACKUP_ROOT}/backups"
TEMP_DIR="${BACKUP_ROOT}/temp"
LOG_DIR="${BACKUP_ROOT}/logs"

# --- S3 CONFIGURATION (AWS) ---
S3_BUCKET="mtn-admision-backups"
S3_REGION="us-east-1"
S3_ENCRYPTION="AES256"
AWS_PROFILE="default"

# Alternative: MinIO (S3-compatible local storage)
USE_MINIO=true
MINIO_ENDPOINT="http://localhost:9000"
MINIO_ACCESS_KEY="minioadmin"
MINIO_SECRET_KEY="minioadmin"
MINIO_BUCKET="mtn-backups"

# --- RETENTION POLICY ---
# Retención de backups completos: 30 días
FULL_BACKUP_RETENTION_DAYS=30
# Retención de backups diferenciales: 90 días
DIFF_BACKUP_RETENTION_DAYS=90

# --- BACKUP SCHEDULE ---
# Backup completo: diario a las 02:00 AM
FULL_BACKUP_HOUR="02"
FULL_BACKUP_MINUTE="00"

# Backup diferencial: cada hora
DIFF_BACKUP_INTERVAL="hourly"

# --- COMPRESSION ---
COMPRESSION_LEVEL=9  # 1-9 (9 = máxima compresión)
COMPRESSION_TOOL="gzip"  # gzip, bzip2, xz

# --- ENCRYPTION ---
ENABLE_ENCRYPTION=true
ENCRYPTION_KEY_FILE="${BACKUP_ROOT}/config/.encryption.key"
GPG_RECIPIENT="backup@mtn.cl"

# --- MONITORING & ALERTS ---
ENABLE_MONITORING=true
METRICS_DIR="${LOG_DIR}/metrics"
ALERT_EMAIL="admin@mtn.cl"
SMTP_SERVER="smtp.gmail.com"
SMTP_PORT="587"
SMTP_USER="admision@mtn.cl"
SMTP_PASSWORD="elecdqywuqyuhafr"

# --- RPO/RTO TARGETS ---
# Recovery Point Objective (RPO): 1 hora máximo
TARGET_RPO_HOURS=1
# Recovery Time Objective (RTO): 4 horas máximo
TARGET_RTO_HOURS=4

# --- VERIFICATION ---
ENABLE_POST_BACKUP_VERIFY=true
ENABLE_POST_RESTORE_VERIFY=true
STAGING_DB_NAME="Admisión_MTN_DB_staging"

# --- PARALLEL PROCESSING ---
PARALLEL_JOBS=4

# --- NETWORK ---
NETWORK_TIMEOUT=3600  # 1 hour for large backups
MAX_RETRIES=3
RETRY_DELAY=60  # seconds

# --- LOGGING ---
LOG_LEVEL="INFO"  # DEBUG, INFO, WARN, ERROR
LOG_RETENTION_DAYS=90
ENABLE_SYSLOG=true

# ============================================================
# MICROSERVICES CONFIGURATION
# ============================================================
SERVICES=(
    "user-service:8082"
    "application-service:8083"
    "evaluation-service:8084"
    "notification-service:8085"
    "dashboard-service:8086"
    "guardian-service:8087"
)

# ============================================================
# BACKUP METADATA
# ============================================================
BACKUP_PREFIX="admision_mtn"
INCLUDE_TIMESTAMP=true
INCLUDE_HOSTNAME=true

# End of configuration
