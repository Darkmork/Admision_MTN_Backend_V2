{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://schemas.mtn.cl/events/EvaluationCompleted/v1.0.0",
  "title": "EvaluationCompleted Event",
  "description": "Event published when an evaluation is completed by an evaluator",
  "type": "object",
  "required": [
    "eventId",
    "eventType",
    "eventVersion", 
    "timestamp",
    "source",
    "data"
  ],
  "properties": {
    "eventId": {
      "type": "string",
      "format": "uuid",
      "description": "Unique identifier for this event instance"
    },
    "eventType": {
      "type": "string",
      "const": "EvaluationCompleted",
      "description": "Type of event - always 'EvaluationCompleted'"
    },
    "eventVersion": {
      "type": "string",
      "const": "1.0.0",
      "description": "Version of this event schema"
    },
    "timestamp": {
      "type": "string",
      "format": "date-time",
      "description": "When the evaluation was completed"
    },
    "source": {
      "type": "string",
      "const": "evaluation-service",
      "description": "Source service that published this event"
    },
    "correlationId": {
      "type": "string",
      "format": "uuid",
      "description": "Correlation ID for distributed tracing"
    },
    "causationId": {
      "type": "string",
      "format": "uuid",
      "description": "ID of the command that caused this event"
    },
    "data": {
      "type": "object",
      "required": [
        "evaluationId",
        "applicationId",
        "evaluatorId",
        "subject",
        "level",
        "completedAt",
        "totalScore",
        "maxScore",
        "passed"
      ],
      "properties": {
        "evaluationId": {
          "type": "string",
          "format": "uuid",
          "description": "Unique identifier of the evaluation"
        },
        "applicationId": {
          "type": "string", 
          "format": "uuid",
          "description": "Application this evaluation belongs to"
        },
        "evaluatorId": {
          "type": "string",
          "description": "ID of the evaluator who completed the evaluation"
        },
        "subject": {
          "type": "string",
          "enum": ["GENERAL", "LANGUAGE", "MATHEMATICS", "ENGLISH", "ALL_SUBJECTS"],
          "description": "Subject of the evaluation"
        },
        "level": {
          "type": "string",
          "enum": ["PRESCHOOL", "BASIC", "HIGH_SCHOOL", "ALL_LEVELS"],
          "description": "Educational level of the evaluation"
        },
        "assignedAt": {
          "type": "string",
          "format": "date-time",
          "description": "When the evaluation was assigned"
        },
        "startedAt": {
          "type": "string",
          "format": "date-time",
          "description": "When the evaluation was started"
        },
        "completedAt": {
          "type": "string",
          "format": "date-time",
          "description": "When the evaluation was completed"
        },
        "totalScore": {
          "type": "number",
          "minimum": 0,
          "description": "Total score achieved"
        },
        "maxScore": {
          "type": "number",
          "minimum": 0,
          "description": "Maximum possible score"
        },
        "percentage": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Percentage score (totalScore/maxScore * 100)"
        },
        "passed": {
          "type": "boolean",
          "description": "Whether the evaluation was passed"
        },
        "passingThreshold": {
          "type": "number",
          "minimum": 0,
          "maximum": 100,
          "description": "Minimum percentage required to pass"
        },
        "evaluationDetails": {
          "type": "object",
          "properties": {
            "duration": {
              "type": "integer",
              "minimum": 0,
              "description": "Duration of evaluation in minutes"
            },
            "processingTimeMinutes": {
              "type": "integer",
              "minimum": 0,
              "description": "Time taken from assignment to completion"
            },
            "slaExceeded": {
              "type": "boolean",
              "description": "Whether the evaluation exceeded its SLA"
            },
            "expectedCompletionAt": {
              "type": "string",
              "format": "date-time",
              "description": "When the evaluation was expected to be completed"
            },
            "priority": {
              "type": "integer",
              "minimum": 1,
              "maximum": 10,
              "description": "Priority level (1=highest, 10=lowest)"
            }
          }
        },
        "results": {
          "type": "object",
          "description": "Detailed evaluation results",
          "properties": {
            "notes": {
              "type": "string",
              "maxLength": 2000,
              "description": "Evaluator notes and observations"
            },
            "strengths": {
              "type": "array",
              "items": {
                "type": "string",
                "maxLength": 500
              },
              "description": "Identified strengths"
            },
            "weaknesses": {
              "type": "array",
              "items": {
                "type": "string",
                "maxLength": 500
              },
              "description": "Identified areas for improvement"
            },
            "recommendations": {
              "type": "array",
              "items": {
                "type": "string",
                "maxLength": 500
              },
              "description": "Recommendations for the student"
            },
            "categories": {
              "type": "array",
              "items": {
                "type": "object",
                "required": ["name", "score", "maxScore"],
                "properties": {
                  "name": {
                    "type": "string",
                    "description": "Category name"
                  },
                  "score": {
                    "type": "number",
                    "minimum": 0,
                    "description": "Score in this category"
                  },
                  "maxScore": {
                    "type": "number",
                    "minimum": 0,
                    "description": "Maximum score for this category"
                  },
                  "percentage": {
                    "type": "number",
                    "minimum": 0,
                    "maximum": 100,
                    "description": "Percentage for this category"
                  },
                  "comments": {
                    "type": "string",
                    "maxLength": 1000,
                    "description": "Comments for this category"
                  }
                }
              },
              "description": "Breakdown by evaluation categories"
            }
          }
        },
        "nextSteps": {
          "type": "object",
          "properties": {
            "requiresInterview": {
              "type": "boolean",
              "description": "Whether an interview is recommended"
            },
            "requiresAdditionalEvaluation": {
              "type": "boolean", 
              "description": "Whether additional evaluation is needed"
            },
            "recommendedAction": {
              "type": "string",
              "enum": ["APPROVE", "REJECT", "INTERVIEW_REQUIRED", "ADDITIONAL_EVALUATION", "REVIEW_NEEDED"],
              "description": "Recommended next action"
            },
            "comments": {
              "type": "string",
              "maxLength": 1000,
              "description": "Additional comments about next steps"
            }
          }
        }
      }
    },
    "metadata": {
      "type": "object",
      "description": "Additional event metadata",
      "properties": {
        "evaluatorDetails": {
          "type": "object",
          "properties": {
            "evaluatorName": {
              "type": "string",
              "description": "Name of the evaluator"
            },
            "evaluatorRole": {
              "type": "string",
              "enum": ["TEACHER", "PSYCHOLOGIST", "COORDINATOR"],
              "description": "Role of the evaluator"
            },
            "evaluatorSpecialization": {
              "type": "string",
              "description": "Specialization of the evaluator"
            }
          }
        },
        "assignmentReason": {
          "type": "string",
          "enum": ["AUTOMATIC", "MANUAL", "REASSIGNMENT", "WORKLOAD_BALANCE", "SPECIALIZATION_MATCH"],
          "description": "Why this evaluator was assigned"
        },
        "traceId": {
          "type": "string",
          "format": "uuid",
          "description": "Distributed tracing ID"
        },
        "sessionId": {
          "type": "string",
          "format": "uuid",
          "description": "Evaluator session ID"
        },
        "device": {
          "type": "string",
          "description": "Device used for evaluation"
        }
      }
    }
  },
  "examples": [
    {
      "eventId": "550e8400-e29b-41d4-a716-446655440010",
      "eventType": "EvaluationCompleted",
      "eventVersion": "1.0.0",
      "timestamp": "2024-03-15T14:45:00Z",
      "source": "evaluation-service",
      "correlationId": "123e4567-e89b-12d3-a456-426614174000",
      "causationId": "456e7890-e12b-34d5-a678-901234567890",
      "data": {
        "evaluationId": "eval-550e8400-e29b-41d4-a716-446655440011",
        "applicationId": "app-550e8400-e29b-41d4-a716-446655440001",
        "evaluatorId": "maria.teacher@mtn.cl",
        "subject": "MATHEMATICS",
        "level": "BASIC",
        "assignedAt": "2024-03-14T09:00:00Z",
        "startedAt": "2024-03-15T13:30:00Z",
        "completedAt": "2024-03-15T14:45:00Z",
        "totalScore": 85,
        "maxScore": 100,
        "percentage": 85.0,
        "passed": true,
        "passingThreshold": 70.0,
        "evaluationDetails": {
          "duration": 75,
          "processingTimeMinutes": 1725,
          "slaExceeded": false,
          "expectedCompletionAt": "2024-03-16T09:00:00Z",
          "priority": 5
        },
        "results": {
          "notes": "Estudiante demuestra buen manejo de conceptos básicos de matemáticas. Destaca en operaciones aritméticas y resolución de problemas simples.",
          "strengths": [
            "Excelente comprensión de operaciones básicas",
            "Buena capacidad de razonamiento lógico",
            "Muestra interés y motivación por aprender"
          ],
          "weaknesses": [
            "Necesita reforzar conceptos de geometría",
            "Velocidad de cálculo mental puede mejorar"
          ],
          "recommendations": [
            "Continuar desarrollando habilidades matemáticas",
            "Practicar más ejercicios de geometría básica",
            "Fomentar el cálculo mental con juegos"
          ],
          "categories": [
            {
              "name": "Operaciones Aritméticas",
              "score": 22,
              "maxScore": 25,
              "percentage": 88.0,
              "comments": "Muy buen manejo de suma y resta"
            },
            {
              "name": "Resolución de Problemas",
              "score": 20,
              "maxScore": 25,
              "percentage": 80.0,
              "comments": "Entiende bien los enunciados y aplica estrategias correctas"
            },
            {
              "name": "Geometría Básica",
              "score": 18,
              "maxScore": 25,
              "percentage": 72.0,
              "comments": "Conoce figuras básicas pero confunde algunas propiedades"
            },
            {
              "name": "Números y Patrones",
              "score": 25,
              "maxScore": 25,
              "percentage": 100.0,
              "comments": "Excelente reconocimiento de patrones numéricos"
            }
          ]
        },
        "nextSteps": {
          "requiresInterview": true,
          "requiresAdditionalEvaluation": false,
          "recommendedAction": "INTERVIEW_REQUIRED",
          "comments": "Buen resultado académico. Se recomienda entrevista psicológica para evaluación integral."
        }
      },
      "metadata": {
        "evaluatorDetails": {
          "evaluatorName": "María Elena González",
          "evaluatorRole": "TEACHER",
          "evaluatorSpecialization": "MATHEMATICS - BASIC"
        },
        "assignmentReason": "SPECIALIZATION_MATCH",
        "traceId": "trace-550e8400-e29b-41d4-a716-446655440012",
        "sessionId": "session-550e8400-e29b-41d4-a716-446655440013",
        "device": "Web Browser - Chrome 122.0"
      }
    }
  ]
}